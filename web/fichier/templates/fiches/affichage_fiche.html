{% load fichier_extras %}
<div id="actions">
    {% if details %} <a href="{% url 'fichier:detail' fiche.id %}"><button>plein écran</button></a> {% endif %}
    <a href="{% url 'admin:index' %}fichier/fiche/{{ fiche.id }}/change/" id="edit_button"><button>éditer (ctrl-e)</button></a>
    <button onclick="window.print()">pdf</button>
</div>
<page size="A4">
    <div id="contenu_page">
        <div id="entete">
            <div class="gauche">
                <p class="nomenclature">
                    {{ fiche.niveau.couleur | carre_colore }}
                    <a class="internal" href="{% url 'fichier:index' %}">Projet365</a> — 
                    <a class="internal" href="{% url 'fichier:index_niveau' fiche.niveau.id %}">{{ fiche.niveau }}</a>
                    <a class="internal" href="{% url 'fichier:index_categorie' fiche.categorie1.id %}">{{ fiche.categorie1 }}</a>
                    <a class="internal" href="{% url 'fichier:index_auteur' fiche.auteur.id %}">{{ fiche.auteur }}</a>
                    {{ fiche.numero  | number_xxxx }}</p>
                <h1>{{ fiche.titre_fiche }}<br> <small>{{ fiche.sous_titre }}</small> </h1>
            </div>
            <div class="droite">
                <strong>Catégorie</strong><br />
                <a class="internal" href="{% url 'fichier:index_niveau' fiche.niveau.id %}">{{ fiche.niveau.code }}</a>, <a class="internal" href="{% url 'fichier:index_categorie' fiche.categorie1.id %}">{{ fiche.categorie1 }}</a>{% if fiche.categorie2 %}, <a class="internal" href="{% url 'fichier:index_categorie' fiche.categorie2.id %}">{{ fiche.categorie2 }}</a>{% endif %}{% if fiche.categorie3 %}, <a class="internal" href="{% url 'fichier:index_categorie' fiche.categorie3.id %}">{{ fiche.categorie3 }}</a>{% endif %}{% for cl in fiche.categories_libres.all %}, <a class="internal" href="{% url 'fichier:index_categorie_libre' cl.id %}">{{ cl }}</a>{% endfor %}<br />
                <strong>Auteur</strong><br />
                <a class="internal" href="{% url 'fichier:index_auteur' fiche.auteur.id %}">{{ fiche.auteur.nom }}</a><br />
                <strong>Date création</strong><br />
                {{ fiche.date_creation }}<br />
                <strong>Date dernière modification</strong><br />
                {{ fiche.date_derniere_modification }}
            </div>
        </div>
        <div id="principal">
            {% autoescape off %}
            <div id="chapeau">
                <ul>
                    {{ fiche.url | cliquable | affiche_si_existe:"Adresse" | inside_si_existe:"li" }}
                    {{ fiche.titre | affiche_si_existe:"Titre" | inside_si_existe:"li" }}
                    {{ fiche.auteurs | affiche_si_existe:"Auteur(s)" | inside_si_existe:"li" }}
                    {{ fiche.annee_publication | affiche_si_existe:"Année de publication" | inside_si_existe:"li" }}
                    {{ fiche.editeur | affiche_si_existe:"Éditeur" | inside_si_existe:"li" }}
                    {{ fiche.format_bibl | affiche_si_existe:"Format" | inside_si_existe:"li" }}
                    {{ fiche.realisateurs | affiche_si_existe:"Réalisateurs" | inside_si_existe:"li" }}
                    {{ fiche.annee_film | affiche_si_existe:"Année de production" | inside_si_existe:"li" }}
                    {{ fiche.diffusion | affiche_si_existe:"Diffusion" | inside_si_existe:"li" }}
                    {{ fiche.duree | affiche_si_existe:"Durée" | inside_si_existe:"li" }}
                    {{ fiche.production | affiche_si_existe:"Production" | inside_si_existe:"li" }}
                    {{ fiche.partenaires | affiche_si_existe:"Partenaires" | inside_si_existe:"li" }}
                    {% if fiche.themes.all %}
                    <li><strong>Thèmes&nbsp;:</strong>
                    {% for theme in fiche.themes.all %}{% if not forloop.first %}, {% endif %}<a class="internal" href="{% url 'fichier:index_theme' theme.id %}">{{ theme.nom }}</a>{% endfor %}
                    </li>
                    {% endif %}
                    {% if fiche.mots_cles.all %}
                    <li><strong>Mots-clés&nbsp;:</strong>
                    {% for motcle in fiche.mots_cles.all %}{% if not forloop.first %}, {% endif %}<a class="internal" href="{% url 'fichier:index_motcle' motcle.id %}">{{ motcle.nom }}</a>{% endfor %}
                    </li>
                    {% endif %}
                </ul>
            </div>
            <div id="corps">
                {{ fiche.presentation | safe | affiche_si_existe:"Présentation" | inside_si_existe:"p" }}
                {{ fiche.problematique | safe | affiche_si_existe:"Problématique" | inside_si_existe:"p" }}
                {{ fiche.quatrieme_de_couverture | safe | affiche_si_existe:"Quatrième de couverture" | inside_si_existe:"p" }}
                {{ fiche.plan_du_site | safe | affiche_si_existe:"Plan du site" | inside_si_existe:"p" }}
                {% affiche_bloc_si_existe fiche.focus|safe "Focus" fiche.detail_focus %}
            </div>
            <div id="pied">
                <ul>
                    {{ fiche.reserves | affiche_si_existe:"Réserves" | inside_si_existe:"li" }}
                    {{ fiche.lesplus | affiche_si_existe:"Les plus" | inside_si_existe:"li" }}
                    {{ fiche.en_savoir_plus | affiche_si_existe:"En savoir plus" | inside_si_existe:"li" }}
                    {% if fiche.fiches_connexes.all %}
                    <li><strong>Fiches connexes&nbsp;:</strong>
                    {% for connexe in fiche.fiches_connexes.all %}{% if not forloop.first %}, {% endif %}<a class="internal" href="{% url 'fichier:detail' connexe.id %}">{{ connexe.nom }}</a>{% endfor %}
                    </li>
                    {% endif %}
                </ul>
                {% endautoescape %}
                
            </div>
        </div>
    </div>
</page>
